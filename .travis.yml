branches:
  only:
    - master
    - develop

language: cpp

arch:
  - amd64

os:
  - linux
  - osx
  - windows

dist: bionic
osx_image: xcode11.3
addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
      - llvm-toolchain-9
    packages:
      - g++-9
      - clang-9

script: |
  mkdir build
  cd build
  if [ "$TRAVIS_OS_NAME" == "windows" ]; then
    cmake .. -DCMAKE_BUILD_TYPE=$BUILD_CONFIGURATION -DTARGET_CPU=$TARGET_CPU -A $TARGET_PLATFORM || exit 1
  else
    cmake .. -DCMAKE_BUILD_TYPE=$BUILD_CONFIGURATION -DTARGET_CPU=$TARGET_CPU || exit 1
  fi
  cmake --build . || exit 1
  ctest --output-on-failure || exit 1

matrix:
  include:
    # Linux + GCC
    - os: linux
      env:
        - TARGET_CPU=amd64 BUILD_CONFIGURATION=Debug TARGET_PLATFORM=x64 MATRIX_EVAL="CC=gcc-9 && CXX=g++-9"
        - TARGET_CPU=amd64 BUILD_CONFIGURATION=Release TARGET_PLATFORM=x64 MATRIX_EVAL="CC=gcc-9 && CXX=g++-9"
      before_install:
        - eval "${MATRIX_EVAL}"
    # Linux + Clang
    - os: linux
      env:
        - TARGET_CPU=amd64 BUILD_CONFIGURATION=Debug TARGET_PLATFORM=x64 MATRIX_EVAL="CC=clang-9 && CXX=clang++-9"
        - TARGET_CPU=amd64 BUILD_CONFIGURATION=Release TARGET_PLATFORM=x64 MATRIX_EVAL="CC=clang-9 && CXX=clang++-9"
      before_install:
        - eval "${MATRIX_EVAL}"
    # macOS + GCC
    - os: osx
      env:
        - TARGET_CPU=amd64 BUILD_CONFIGURATION=Debug TARGET_PLATFORM=x64 MATRIX_EVAL="brew install gcc@9 && CC=gcc-9 && CXX=g++-9"
        - TARGET_CPU=amd64 BUILD_CONFIGURATION=Release TARGET_PLATFORM=x64 MATRIX_EVAL="brew install gcc@9 && CC=gcc-9 && CXX=g++-9"
      before_install:
        - eval "${MATRIX_EVAL}"
    # macOS + Clang
    - os: osx
      env:
        - TARGET_CPU=amd64 BUILD_CONFIGURATION=Debug TARGET_PLATFORM=x64
        - TARGET_CPU=amd64 BUILD_CONFIGURATION=Release TARGET_PLATFORM=x64
    # Windows + MSVC
    - os: windows
      env:
        - TARGET_CPU=amd64 BUILD_CONFIGURATION=Debug TARGET_PLATFORM=x64
        - TARGET_CPU=amd64 BUILD_CONFIGURATION=Release TARGET_PLATFORM=x64
